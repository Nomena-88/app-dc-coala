<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>Application DC - Gestion Tiers & Import Grand Livre</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
  <script src="https://cdn.sheetjs.com/xlsx-0.20.3/package/dist/xlsx.full.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <style>
    body { background:#f4f4f4; }
    .container-box { max-width: 1000px; margin: 2rem auto; background: white; padding: 1.5rem; border-radius: 8px; box-shadow: 0 2px 6px rgba(0,0,0,0.1);}
    textarea { font-family: monospace; }
    .hidden { display: none; }
    .table thead { background:#003366; color:white; }
    .btn-primary { background:#003366; border:none; }
    .btn-primary:hover { background:#0055aa; }
    .logo-img { height:40px; }
    .top-actions { display:flex; justify-content:flex-end; margin-bottom:10px; }
  </style>
</head>

  
<body>
  <!-- NAVBAR -->
  <nav class="navbar navbar-expand-lg navbar-dark" style="background:#003366;">
    <div class="container-fluid">
      <a class="navbar-brand d-flex align-items-center" href="#">
        <img src="logo.png" alt="Logo" class="logo-img me-2"> Application DC
      </a>
    </div>
  </nav>

  <!-- LOGIN -->
  <div class="container-box" id="loginSection">
    <h2>Connexion</h2>
    <input type="text" id="username" class="form-control my-2" placeholder="Identifiant" />
    <input type="password" id="password" class="form-control my-2" placeholder="Mot de passe" />
    <button class="btn btn-primary w-100" onclick="login()">Se connecter</button>
    <p id="loginError" style="color:red;"></p>
  </div>

  <!-- GESTION TIERS -->
  <div class="container-box hidden" id="fournisseursSection">
    <div class="top-actions">
      <button class="btn btn-outline-secondary" onclick="logout()">‚¨Ö D√©connexion</button>
    </div>
    <h2>Gestion des Tiers</h2>
    <form id="formFournisseur" class="row g-2">
      <div class="col-md-3"><input type="text" id="inputRaison" class="form-control" placeholder="Raison Sociale" required></div>
      <div class="col-md-2"><input type="text" id="inputNIF" class="form-control" placeholder="NIF"></div>
      <div class="col-md-2"><input type="text" id="inputStatut" class="form-control" placeholder="Statut"></div>
      <div class="col-md-3"><input type="text" id="inputAdresse" class="form-control" placeholder="Adresse"></div>
      <div class="col-md-2"><button type="submit" class="btn btn-primary w-100">Ajouter</button></div>
    </form>

    <div class="mt-3">
      <input type="text" id="searchInput" class="form-control" placeholder="üîç Rechercher un tiers...">
    </div>

    <h3 class="mt-4">Liste des tiers enregistr√©s</h3>
    <table class="table table-bordered mt-3" id="tableFournisseurs">
      <thead>
        <tr><th>Raison Sociale</th><th>NIF</th><th>Statut</th><th>Adresse</th><th>Actions</th></tr>
      </thead>
      <tbody></tbody>
    </table>

    <div class="d-flex justify-content-between">
      <button class="btn btn-secondary" id="prevPage">‚¨Ö Pr√©c√©dent</button>
      <span id="pageInfo" class="align-self-center"></span>
      <button class="btn btn-secondary" id="nextPage">Suivant ‚û°</button>
    </div>

    <button class="btn btn-primary mt-4" onclick="afficherImportSection()">Passer √† l'import Grand Livre</button>
  </div>

  <!-- IMPORT GL -->
  <div class="container-box hidden" id="importSection">
    <div class="top-actions">
      <button class="btn btn-outline-secondary" onclick="backToTiers()">‚¨Ö Retour √† la gestion des tiers</button>
    </div>
    <h2>Import du grand livre</h2>
    <p><b>Format attendu :</b> colonnes : Date, Compte, Tiers, NIF, Libelle, Debit, Credit</p>
    <input type="file" id="csvFile" class="form-control mb-2" accept=".csv,.xlsx" />
    <button class="btn btn-primary w-100" onclick="processFile()">Importer et calculer (classe 6)</button>

    <div id="results" class="hidden mt-4">
      <h2>Tableau de d√©claration (Canevas DC)</h2>
      <table class="table table-bordered" id="resultsTable">
        <thead>
          <tr><th>Fournisseur (Tiers)</th><th>NIF</th><th>Statut</th><th>Adresse</th><th>Total HT</th></tr>
        </thead>
        <tbody></tbody>
        <tfoot>
          <tr><th colspan="4">TOTAL</th><th id="grandTotal"></th></tr>
        </tfoot>
      </table>
      <button class="btn btn-success" onclick="exportCSV()">‚¨á Exporter en CSV</button>
      <button class="btn btn-danger" onclick="exportPDF()">‚¨á Exporter en PDF</button>
    </div>
  </div>

<script>
  let fournisseursArray = JSON.parse(localStorage.getItem("fournisseursArray") || "[]");
  let currentPage = 1;
  const itemsPerPage = 5;

  function login() {
    const user = document.getElementById("username").value;
    const pass = document.getElementById("password").value;
    if(user === "admin" && pass === "dc2025"){
      document.getElementById("loginSection").classList.add("hidden");
      document.getElementById("fournisseursSection").classList.remove("hidden");
      majTableFournisseurs();
    }
    else document.getElementById("loginError").textContent = "Identifiants invalides.";
  }

  function logout(){
    document.getElementById("fournisseursSection").classList.add("hidden");
    document.getElementById("importSection
